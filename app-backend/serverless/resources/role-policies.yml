---
# used by roles.yml, not included directly
PreciselyDefaultPolicy:
  PolicyName: PreciselyDefaultPolicy
  PolicyDocument:
    Version: '2012-10-17'
    Statement:
      - Effect: Allow # note that these rights are given in the default policy and are required if you want logs out of your lambda(s)
        Action:
          - logs:CreateLogGroup
          - logs:CreateLogStream
          - logs:PutLogEvents
        Resource:
          - Fn::Join:
            - ':'
            - - arn:aws:logs
              - Ref: AWS::Region
              - Ref: AWS::AccountId
              - log-group:/aws/lambda/*:*:*
      - Effect: Allow
        Action: s3:PutObject
        Resource:
          - arn:aws:s3:::${self:provider.deploymentBucket}

PreciselyAPIPolicy:
  PolicyName: ${self:provider.stage}-PreciselyAPIPolicy
  PolicyDocument:
    Version: '2012-10-17'
    Statement:
      - ${file(./serverless/resources/dynogels-tables.js):Permissions.Report.read}
      - ${file(./serverless/resources/dynogels-tables.js):Permissions.Report.write}
      - ${file(./serverless/resources/dynogels-tables.js):Permissions.VariantCall.read}

IngestionECSTaskPolicy:
  PolicyName: ${self:provider.stage}-IngestionECSTaskPolicy
  PolicyDocument:
    Version: '2012-10-17'
    Statement:
      - Effect: Allow
        Action:
          - s3:GetObject
          - s3:PutObject
        Resource: arn:aws:s3:::*/*
      - Effect: Allow # note that these rights are given in the default policy and are required if you want logs out of your tasks(s)
        Action:
          - logs:CreateLogGroup
          - logs:CreateLogStream
          - logs:PutLogEvents
        Resource:
          - Fn::Join:
            - ':'
            - - arn:aws:logs
              - Ref: AWS::Region
              - Ref: AWS::AccountId
              - log-group:/aws/ecs/*:*:*

RawUploadLambdaPolicy:
  PolicyName: ${self:provider.stage}-RawUploadLambdaPolicy
  PolicyDocument:
    Version: '2012-10-17'
    Statement:
      - Effect: Allow
        Action:
          - s3:GetObject
          - s3:PutObject
        Resource: "arn:aws:s3:::*/*"
      - Effect: Allow
        Action:
          - '*'
        Resource: "*"
...
